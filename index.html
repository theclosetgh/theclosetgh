<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>THE CLOSET</title>

<style>
  *{margin:0;padding:0;box-sizing:border-box}
  body{font-family:Arial,sans-serif;background:#f8f8f8;color:#333}

  header{background:#000;color:#fff;padding:20px 0;text-align:center;position:sticky;top:0;z-index:1000}
  header h1{letter-spacing:3px;font-size:2rem}
  nav a{color:#fff;text-decoration:none;margin:0 15px;font-weight:bold}
  nav a:hover{color:#ff4081}

  .hero{width:100%;height:100vh;background:url('home.jpg') no-repeat center center/cover;display:flex;align-items:center;justify-content:center;position:relative;text-align:center;color:#fff}
  .hero::after{content:'';position:absolute;inset:0;background:rgba(0,0,0,.5)}
  .hero-content{position:relative;z-index:2;padding:0 14px}
  .hero h2{font-size:3rem;margin-bottom:20px}
  .hero button{background:#ff4081;border:none;color:#fff;padding:15px 30px;font-size:1.2rem;cursor:pointer;border-radius:10px}
  .hero button:hover{opacity:.92}

  section{padding:50px 20px;max-width:1200px;margin:auto}
  section h2{text-align:center;margin-bottom:16px}
  .hint{max-width:760px;margin:0 auto 22px auto;text-align:center;color:#666}

  .products{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:25px}
  .product{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 4px 10px rgba(0,0,0,.1);padding-bottom:15px;transition:transform .3s;position:relative}
  .product:hover{transform:translateY(-5px)}
  .product img{width:100%;height:300px;object-fit:contain;background:#fff}
  .product-content{padding:15px;text-align:center}
  .product-content h3{margin-bottom:5px}
  .product-content p{font-size:.95rem;color:#666}

  .badge-top{
    position:absolute;top:12px;left:12px;
    background:#111;color:#fff;font-weight:bold;
    padding:6px 10px;border-radius:999px;font-size:.85rem;
    box-shadow:0 6px 18px rgba(0,0,0,.15);
  }
  .badge-top.out{background:#b00020}

  .price{margin:10px 0;display:flex;gap:10px;justify-content:center;align-items:center;flex-wrap:wrap}
  .price .old{color:#999;text-decoration:line-through;font-weight:bold}
  .price .new{color:#ff4081;font-weight:bold}
  .price .disc{background:#ff4081;color:#fff;font-weight:bold;padding:4px 8px;border-radius:999px;font-size:.85rem}

  .whatsapp-btn{display:inline-block;margin-top:10px;background:#25D366;color:#fff;padding:10px 20px;text-decoration:none;border-radius:8px;font-weight:bold;transition:background .3s}
  .whatsapp-btn:hover{background:#128C7E}
  .whatsapp-btn.disabled{
    background:#cfcfcf;color:#666;pointer-events:none;cursor:not-allowed;
  }

  label{display:block;margin-top:10px;font-weight:bold}
  select,input[type="number"]{margin-top:5px;padding:8px;width:85%;border:1px solid #ddd;border-radius:8px}

  .contact{text-align:center;background:#fff;padding:30px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.05)}
  .contact a{display:block;margin-top:10px;text-decoration:none;color:#000;font-weight:bold}
  .contact a:hover{text-decoration:underline}

  footer{background:#000;color:#fff;text-align:center;padding:20px;margin-top:40px}
  footer a{color:#fff;font-weight:bold}

  @media (max-width:768px){
    .hero h2{font-size:2rem}
    .products{grid-template-columns:repeat(2,1fr)}
  }
  @media (max-width:480px){
    .products{grid-template-columns:1fr}
  }
</style>
</head>

<body>
<header>
  <h1>THE CLOSET</h1>
  <nav>
    <a href="#home">HOME</a>
    <a href="#shop">SHOP</a>
    <a href="#contact">CONTACT</a>
    <a href="workers.html">WORKERS</a>
  </nav>
</header>

<section id="home" class="hero">
  <div class="hero-content">
    <h2>Welcome to THE CLOSET</h2>
    <button onclick="document.getElementById('shop').scrollIntoView({behavior:'smooth'})">Shop Now</button>
  </div>
</section>

<section id="shop">
  <h2>Available Dresses</h2>
  <p class="hint">All items are loaded online â€” everyone sees the same stock.</p>
  <div class="products" id="productsGrid"></div>
</section>

<section id="contact">
  <h2>Contact</h2>
  <div class="contact">
    <a href="https://wa.me/233503674353" target="_blank">ðŸ“± WhatsApp: 0503674353</a>
    <a href="https://www.tiktok.com/@the.closetgh" target="_blank">ðŸŽµ TikTok: @the.closetgh</a>
  </div>
</section>

<footer>
  <p>Â© 2026 THE CLOSET â€¢ <a href="workers.html">Workers</a></p>
</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import { getFirestore, collection, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

  // ===== YOUR FIREBASE CONFIG =====
  const firebaseConfig = {
    apiKey: "AIzaSyCcEqZ9Mga_JcVSAeQv1DKNLlo0QCItYI0",
    authDomain: "the-closet-ee4ef.firebaseapp.com",
    projectId: "the-closet-ee4ef",
    storageBucket: "the-closet-ee4ef.firebasestorage.app",
    messagingSenderId: "386905202760",
    appId: "1:386905202760:web:efe9e882049ce7ad31f87d",
    measurementId: "G-RK2H1B1CVW"
  };
  // ===============================

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const WHATSAPP_NUMBER = "233503674353";
  const GLOBAL_DISCOUNT_PERCENT = 15; // used ONLY when a product's discountEnabled = true

  function money(n){
    const v = Number(n);
    if (Number.isNaN(v)) return "";
    return `GHC ${Math.round(v)}`;
  }
  function discounted(price){
    const p = Number(price);
    return p * (100 - GLOBAL_DISCOUNT_PERCENT) / 100;
  }

  const grid = document.getElementById("productsGrid");

  function cardHTML(p){
    const sizes = Array.isArray(p.sizes) && p.sizes.length ? p.sizes : ["M","L","XL"];
    const basePrice = Number(p.price || 0);

    const outOfStock = !!p.outOfStock;
    const discountEnabled = !!p.discountEnabled;

    const finalPrice = discountEnabled ? discounted(basePrice) : basePrice;

    const options = sizes.map(s => `<option value="${s}">${s}</option>`).join("");

    let priceHTML = `<span class="new">${money(basePrice)}</span>`;
    if (discountEnabled){
      priceHTML = `
        <span class="old">${money(basePrice)}</span>
        <span class="new">${money(finalPrice)}</span>
        <span class="disc">${GLOBAL_DISCOUNT_PERCENT}% OFF</span>
      `;
    }

    const topBadge = outOfStock
      ? `<div class="badge-top out">OUT OF STOCK</div>`
      : (discountEnabled ? `<div class="badge-top">DISCOUNT</div>` : ``);

    const imgSrc = p.imageUrl || "home.jpg";

    return `
      <div class="product" data-price="${basePrice}" data-out="${outOfStock ? "1":"0"}" data-discount="${discountEnabled ? "1":"0"}">
        ${topBadge}
        <img src="${imgSrc}" alt="${p.name || "Product"}">
        <div class="product-content">
          <h3>${p.name || "New Item"}</h3>
          <p>${sizes.join("/")}</p>
          <div class="price">${priceHTML}</div>

          <label>Size:</label>
          <select class="size" ${outOfStock ? "disabled":""}>${options}</select>

          <label>Quantity:</label>
          <input type="number" class="quantity" min="1" max="10" value="1" ${outOfStock ? "disabled":""}>

          <a class="whatsapp-btn ${outOfStock ? "disabled":""}" target="_blank" href="#">
            ${outOfStock ? "Out of Stock" : "WhatsApp to Buy"}
          </a>
        </div>
      </div>
    `;
  }

  function wireWhatsApp(){
    document.querySelectorAll(".product").forEach(product => {
      const out = product.dataset.out === "1";
      if (out) return; // no WhatsApp link for out-of-stock

      const discountOn = product.dataset.discount === "1";
      const basePrice = Number(product.dataset.price || 0);
      const finalPrice = discountOn ? discounted(basePrice) : basePrice;

      const sizeSelect = product.querySelector(".size");
      const qtyInput = product.querySelector(".quantity");
      const btn = product.querySelector(".whatsapp-btn");
      const name = product.querySelector("h3")?.innerText?.trim() || "Item";

      function update(){
        const size = sizeSelect?.value || "";
        const qty = qtyInput?.value || 1;

        const msg =
`Hello THE CLOSET,
I want to order: ${name}
Size: ${size}
Quantity: ${qty}
Price: ${money(finalPrice)}${discountOn ? ` (${GLOBAL_DISCOUNT_PERCENT}% OFF)` : ""}

Please confirm availability.`;

        btn.href = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`;
      }

      sizeSelect?.addEventListener("change", update);
      qtyInput?.addEventListener("input", update);
      update();
    });
  }

  // Live updates for everyone
  const q = query(collection(db, "products"), orderBy("createdAt", "desc"));
  onSnapshot(q, (snap) => {
    if (snap.empty){
      grid.innerHTML = `<p style="grid-column:1/-1;text-align:center;color:#666;">No products yet. Add some from the Workers page.</p>`;
      return;
    }
    grid.innerHTML = snap.docs.map(d => cardHTML(d.data())).join("");
    wireWhatsApp();
  });
</script>

</body>
</html>
